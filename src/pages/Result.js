import React from 'react';
import { useLocation, useNavigate } from 'react-router-dom';
import { Container, Button } from 'react-bootstrap';
import html2pdf from 'html2pdf.js';
import './Result.css';

function Result() {
  const { state } = useLocation();
  const navigate = useNavigate();

  if (!state) {
    return (
      <Container className="text-center mt-5">
        <h5>No result data found.</h5>
        <Button className="mt-3" onClick={() => navigate('/dashboard')}>
          Go to Dashboard
        </Button>
      </Container>
    );
  }

  const { topic, score, total, date, responses = [] } = state;

  const handleDownloadPDF = () => {
    const element = document.getElementById('pdf-container');
    const opt = {
      margin: 0.5,
      filename: `${topic.replace(/\s/g, '_')}_Result.pdf`,
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { scale: 2 },
      jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' },
    };
    html2pdf().set(opt).from(element).save();
  };

  return (
    <Container className="py-5 fade-in">
      <div id="pdf-container" className="pdf-wrapper p-4 shadow-lg rounded-4 bg-white">
        <div className="mb-4 text-center">
          <h2 className="text-teal fw-bold">üìä AptiTrack - Quiz Report</h2>
          <p className="text-muted">Date: <strong>{date}</strong></p>
          <p className="text-muted">Topic: <strong>{topic}</strong></p>
          <h5 className="score-box">Your Score: {score} / {total}</h5>
        </div>

        <div className="response-list">
          {responses.map((res, idx) => (
            <div key={idx} className="response-card p-3 mb-3">
              <h6 className="fw-semibold">{`Q${idx + 1}. ${res.question}`}</h6>
              <p><strong>Your Answer:</strong> <span className={res.isCorrect ? 'text-success' : 'text-danger'}>{res.selectedOption}</span></p>
              {!res.isCorrect && (
                <p><strong>Correct Answer:</strong> <span className="text-success">{res.correctAnswer}</span></p>
              )}
              <p><strong>Explanation:</strong> {res.explanation}</p>
              <div className={`result-tag ${res.isCorrect ? 'correct' : 'wrong'}`}>
                {res.isCorrect ? '‚úîÔ∏è Correct' : '‚ùå Wrong'}
              </div>
            </div>
          ))}
        </div>

        <p className="text-center mt-4 small text-muted">Generated by AptiTrack ¬© 2025</p>
      </div>

      <div className="d-flex justify-content-between mt-4">
        <Button className="btn-teal" onClick={() => navigate('/dashboard')}>
          üîô Back to Dashboard
        </Button>
        <Button className="btn-outline-teal" onClick={handleDownloadPDF}>
          üì• Download PDF
        </Button>
      </div>
    </Container>
  );
}

export default Result;
